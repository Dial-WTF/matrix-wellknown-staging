# Nginx configuration for staging-4.dial.wtf
# Place this in your nginx sites-available directory
# or include it in your main nginx config

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name staging-4.dial.wtf;

    # SSL certificates (use Let's Encrypt)
    ssl_certificate /etc/letsencrypt/live/staging-4.dial.wtf/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/staging-4.dial.wtf/privkey.pem;

    # Serve Matrix .well-known files with correct Content-Type
    location /.well-known/matrix/server {
        add_header Content-Type application/json always;
        add_header Access-Control-Allow-Origin * always;
        return 200 '{"m.server": "matrix.staging-4.dial.wtf:443"}';
    }

    location /.well-known/matrix/client {
        add_header Content-Type application/json always;
        add_header Access-Control-Allow-Origin * always;
        return 200 '{"m.homeserver": {"base_url": "https://matrix.staging-4.dial.wtf"}, "m.identity_server": {"base_url": "https://vector.im"}}';
    }

    # Optional: Serve other static files or redirect everything else
    location / {
        return 404;
    }
}

# HTTP to HTTPS redirect
server {
    listen 80;
    listen [::]:80;
    server_name staging-4.dial.wtf;

    location / {
        return 301 https://$host$request_uri;
    }
}

